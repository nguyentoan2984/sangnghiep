var app=angular.module('myApp',['ngResource','ui.utils','datatables','ngSanitize']);app.factory('donviInfo',function($resource){return $resource('/donviInfo',{},{query:{method:'GET',isArray:!0},save:{method:'POST',isArray:!0},update:{method:'PUT',isArray:!0},delete:{method:'DELETE',params:{id:'@id'},isArray:!0}})});app.factory('counter',function($resource){return $resource('/counter',{},{query:{method:'GET',isArray:!0},save:{method:'POST',isArray:!0},update:{method:'PUT',isArray:!0},delete:{method:'DELETE',params:{id:'@id'},isArray:!0}})});app.factory('staffs',function($resource){return $resource('/staffs',{},{query:{method:'GET',isArray:!0},save:{method:'POST',isArray:!0},update:{method:'PUT',isArray:!0},delete:{method:'DELETE',params:{id:'@id'},isArray:!0}})});app.controller('admin_Controller',['$scope','$location','$resource','donviInfo','counter','staffs','DTOptionsBuilder','DTColumnBuilder','DTColumnDefBuilder',function($scope,$location,$resource,donviInfo,counter,staffs,DTOptionsBuilder,DTColumnBuilder,DTColumnDefBuilder){$scope.dtOptions_tables=DTOptionsBuilder.newOptions().withPaginationType('full_numbers',!1).withOption('ordering',!1).withOption('bFilter',!0).withOption('bInfo',!1).withOption('paging',!1).withOption('lengthMenu',[[5,10,15,20,25,-1],[5,10,15,20,25,"All"]]);$scope.reloadData=function(){$scope.dtOptions.reloadData()};let dataTables_Template=['pages/admin/datatables-cauhinhNhanvien.html','pages/admin/datatables-giamsatNhanvien.html','pages/admin/datatables-giamsatDichvu.html'];$scope.template=dataTables_Template[1];$scope.load_datatables_cauhinhNhanvien=function(){$scope.template=dataTables_Template[0]};$scope.load_datatables_giamsathNhanvien=function(){$scope.template=dataTables_Template[1]};$scope.load_datatables_giamsathDichvu=function(){$scope.template=dataTables_Template[2]};let OFFICEID="empty"
let SERVICEID="empty"
let COUNTERID="empty"
$scope.allCheck1=!1
$scope.allCheck2=!1
function load_donvi_Config(){donviInfo.query({},function(result){$scope.donVi_Config=result},function(){alert("Không load được đơn vị cấu hình vui lòng reset lại trình duyệt")
return})}
load_donvi_Config();$scope.selectdonvi=function(selectedOption){if(!selectedOption)return
if(OFFICEID==selectedOption.OFFICEID)return
$scope.officeService_Config=[]
$scope.officeCounter_Config=[]
$scope.staffs_grid1=[]
$scope.staffs_grid2=[]
SERVICEID="empty"
COUNTERID="empty"
if(selectedOption.OFFICEID!==""&&selectedOption.OFFICEID!==null&&selectedOption.OFFICEID!==undefined)
donviInfo.save({selectedOption},function(result){OFFICEID=selectedOption.OFFICEID
$scope.officeService_Config=result},function(){alert("Không load được dịch vụ vui lòng chọn lại đơn vị cần cấu hình")
return});else{alert(" Bạn vui lòng chọn đơn vị cần cấu hình")}}
$scope.selectService=function(selectedOption){if(!selectedOption)return
if(SERVICEID==selectedOption.SERVICEID)return
$scope.officeCounter_Config=[]
if(selectedOption.SERVICEID!==""&&selectedOption.SERVICEID!==null&&selectedOption.SERVICEID!==undefined)
counter.save({selectedOption,OFFICEID},function(result){$scope.staffs_grid1=[]
$scope.staffs_grid2=[]
SERVICEID=selectedOption.SERVICEID
$scope.officeCounter_Config=result},function(){alert("Không load được các quầy vui lòng chọn lại các dịch vụ")
return});else{alert(" Bạn vui lòng chọn đơn vị cần cấu hình")}}
$scope.selectServiceCounter=function(selectedOption){if(!selectedOption)return
if(COUNTERID==selectedOption.COUNTERID)return
if(selectedOption.COUNTERID!==""&&selectedOption.COUNTERID!==null&&selectedOption.COUNTERID!==undefined)
{$scope.staffs_grid1=[]
$scope.staffs_grid2=[]
staffs.save({selectedOption,OFFICEID,TABLE:"GRID2"},function(result){for(let i=0;i<result.length;i++){result[i].checkBox=!1}
COUNTERID=selectedOption.COUNTERID
$scope.staffs_grid2=result
staffs.save({selectedOption,OFFICEID,TABLE:"GRID1"},function(result){for(let i=0;i<result.length;i++){result[i].checkBox=!1}
COUNTERID=selectedOption.COUNTERID
$scope.staffs_grid1=result},function(){alert("Không load được danh sách các nhân viên")
return})},function(){alert("Không load được danh sách các nhân viên")
return})}
else{alert(" Bạn vui lòng chọn đơn vị cần cấu hình")}}
$scope.capSo=function(){console.log("ok Toàn")
captcha.query({},function(result){console.log(result)},function(){alert("đường truyền mạng có lỗi hoặc reset lại trình duyệt web")
return})}
$scope.allCheckBox1=function(){$scope.allCheck1=!$scope.allCheck1
for(let i=0;i<$scope.staffs_grid1.length;i++){$scope.staffs_grid1[i].checkBox=$scope.allCheck1}}
$scope.checkbox_grid1=function(index){$scope.staffs_grid1[index].checkBox=!$scope.staffs_grid1[index].checkBox}
$scope.allCheckBox2=function(){$scope.allCheck2=!$scope.allCheck2
for(let i=0;i<$scope.staffs_grid2.length;i++){$scope.staffs_grid2[i].checkBox=$scope.allCheck2}}
$scope.checkbox_grid2=function(index){$scope.staffs_grid2[index].checkBox=!$scope.staffs_grid2[index].checkBox}
$scope.update_right=function(){if($scope.staffs_grid1==null||$scope.staffs_grid1==undefined||$scope.staffs_grid1=="")return alert(" bạn vui lòng chọn quầy")
let checked_row=!1
let arrayUpdate=[]
for(let i=0;i<$scope.staffs_grid1.length;i++){if($scope.staffs_grid1[i].checkBox==!0)
{checked_row=!0
arrayUpdate.push($scope.staffs_grid1[i])}}
if(!checked_row)return alert("bạn vui lòng chọn nhân viên trong danh sách nhân viên")
staffs.update({arrayUpdate,OFFICEID,COUNTERID,TABLE:"GRID1"},function(result){for(let i=0;i<arrayUpdate.length;i++){let index=$scope.staffs_grid1.findIndex(x=>x.checkBox==!0);$scope.staffs_grid1.splice(index,1)
arrayUpdate[i].checkBox=!1
$scope.staffs_grid2.push(arrayUpdate[i])}
$scope.reloadData},function(){alert("Không thực hiện được việc update nhân viên")
return})}
$scope.update_left=function(){if($scope.staffs_grid2==null||$scope.staffs_grid2==undefined||$scope.staffs_grid2=="")return alert(" bạn vui lòng chọn quầy")
let checked_row=!1
let arrayUpdate=[]
for(let i=0;i<$scope.staffs_grid2.length;i++){if($scope.staffs_grid2[i].checkBox==!0)
{checked_row=!0
arrayUpdate.push($scope.staffs_grid2[i])}}
if(!checked_row)return alert("bạn vui lòng chọn nhân viên trong danh sách nhân viên tại quầy")
staffs.update({arrayUpdate,OFFICEID,COUNTERID,TABLE:"GRID2"},function(result){for(let i=0;i<arrayUpdate.length;i++){let index=$scope.staffs_grid2.findIndex(x=>x.checkBox==!0);$scope.staffs_grid2.splice(index,1)
arrayUpdate[i].checkBox=!1
arrayUpdate[i].QUAY=0
$scope.staffs_grid1.push(arrayUpdate[i])}
$scope.reloadData},function(){alert("Không thực hiện được việc update nhân viên")
return})}}])